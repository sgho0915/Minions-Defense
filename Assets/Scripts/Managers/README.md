

# 📂 Managers 폴더 구조 및 클래스 간략 설명

### 📌 개요

게임의 전반적인 흐름과 상태, 핵심 시스템을 관리하는 매니저(Manager) 클래스들을 모아놓은 폴더입니다.
이 클래스들은 주로 싱글톤(Singleton) 디자인 패턴을 사용하여 프로젝트 어디에서든 쉽게 접근할 수 있도록 설계되었으며, 게임의 핵심 로직을 중앙에서 통제하는 역할을 담당합니다.

---

## 📁 폴더 내 스크립트 역할

* **`GameManager.cs`**  
  * **주요 책임**
    * 게임의 전반적인 흐름과 상태를 총괄하는 싱글톤(Singleton) 관리자 클래스입니다. 씬이 변경되어도 파괴되지 않으며(DontDestroyOnLoad), 스테이지의 시작, 클리어, 실패 등 핵심 로직을 처리합니다.
    * `SceneManager.sceneLoaded` 이벤트를 구독하여 "Stage_"로 시작하는 씬이 로드될 때마다 필요한 초기화(`InitializeStageScene`) 및 다른 씬으로 전환 시 정리(`CleanupStageScene`) 작업을 자동으로 수행합니다.
    * `RunStage` 코루틴을 통해 웨이브 시작, 모든 몬스터 처치 여부 확인 등 스테이지의 전체적인 흐름을 제어하고, 결과에 따라 스테이지 클리어(`HandleStageClear`) 또는 실패(`HandleStageFail`) 처리를 담당합니다.
    * 스테이지 내에서 사용하는 임시 재화(`stagePoints`)와 영구적으로 저장되는 계정 재화(`globalPoints`)를 관리합니다. PlayerPrefs를 통해 게임 재화와 스테이지 클리어 상태(별 개수)를 저장하고 로드합니다.
    * 스테이지가 시작되면 `WaveManager`, `MainTowerController`, `StageUIManager` 등 씬에 존재하는 핵심 컴포넌트들을 찾아 참조를 설정합니다. 이들과 event를 통해 게임의 주요 상황 변화를 감지하고 대응하는 역할을 합니다.
   * **디자인 패턴**
     * **싱글톤 패턴**: Instance 프로퍼티를 통해 게임 내 어디서든 유일한 `GameManager` 객체에 접근할 수 있도록 하여, 게임 상태와 핵심 로직을 일관성 있게 관리합니다.
     * **단일 책임 원칙**: `GameManager`는 '게임의 흐름과 상태 관리'라는 단일 책임을 가집니다. 몬스터 생성(`WaveManager`), UI 표시(`UIManager`), 타워 로직(`TowerController`) 등은 다른 객체에 위임하고, 자신은 이들을 총괄하는 지휘자(Controller)의 역할에 집중하여 코드의 유지보수성과 확장성을 높입니다.
     * **옵저버 패턴**: `OnStagePointsChanged`와 같은 이벤트를 제공하고, `mainTower.OnDied` 등의 이벤트를 구독함으로 다른 객체와 낮은 의존성과 결합도를 유지합니다. 이는 각 객체가 서로를 직접 알지 못해도 상호작용할 수 있게 하여 시스템을 유연하게 만듭니다.
  
---

* **`GlobalUIManager.cs`**  
  * **주요 책임**
    * 게임 내 모든 씬에서 공통적으로 사용되는 팝업 UI(설정 창, 게임 종료 확인 창 등)를 관리하는 싱글톤 클래스입니다. 'DontDestroyOnLoad'로 설정돼 씬 전환과 관계 없이 일관된 UI 표시를 보장합니다.
    * 공용 UI 프리팹 (ex-`settingsViewPrefab`)을 각 씬에서 `Instantiate`해 관리하며, 필요 시 활성화 하고 사용하지 않을 때 비활성화 해 리소스를 효율적으로 사용합니다.
   * **디자인 패턴**
     * **싱글톤 패턴**: Instance 프로퍼티를 통해 게임 내 어떤 씬의 어떤 스크립트에서든 공용 팝업 View를 호출할 수 있도록 합니다.
     * **Stack 자료구조**: `PushView`와 `PopView` 메서드를 통해 팝업 UI들을 계층적으로 관리합니다. 씬 전환과 관계 없이 동일한 View를 표시해야하는 경우, View를 닫을 때 `StageUIManager`와 `LobbyUIManager`에서 개별적인 로직으로 관리하는 것은 유지보수성을 저해하고, View를 닫았을 경우 직전에 어떤 View가 열렸는지 알 수 없는 문제가 있었습니다. `GlobalUIManager`는 이 문제를 해결하기 위해 `UIView`를 상속받는 새로운 팝업 View가 열리면 스택에 쌓이고(Push), 팝업 View가 닫히면 스택에서 제거(Pop)되어 직전에 열려있던 UI로 자연스럽게 돌아가는 흐름을 제어합니다.
  
---

* **`SoundManager.cs`**  
  * **주요 책임**
    * 게임 내 모든 BGM과 SFX를 중앙에서 관리하고 재생하는 싱글톤 클래스입니다. `DontDestroyOnLoad`로 설정되어 씬이 전환되어도 BGM이 끊기지 않게 하거나 일관된 사운드 설정을 보장합니다.
    * BGM과 SFX를 위한 각각의 AudioSource 컴포넌트를 관리하고 볼륨을 제어합니다.
    * Playerprefs를 사용해 사용자가 설정한 BGM, SFX 볼륨 설정을 저장하고 게임을 다시 시작했을 때 저장된 설정을 불러와 AudioSource에 적용합니다.
    * `PlayBGM`, `PlaySFX`와 같은 공용 메서드를 제공하여 게임 내 다른 어떤 객체든 쉽게 사운드를 재생할 수 있도록 인터페이스 역할을 합니다.
   * **디자인 패턴**
     * **싱글톤 패턴**: 게임 내 모든 사운드 재생 요청을 처리하는 유일한 객체로 사운드 리소스와 설정을 일관성 있게 관리합니다.

---